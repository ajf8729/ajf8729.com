<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Part 02: Active Directory Domain Services - Installation and Configuration">
<meta name=twitter:description content="Active Directory Domain Services - Installation and Configuration">
<meta name=twitter:image content="https://ajf8729.com/icon.png">
<title>Part 02: Active Directory Domain Services - Installation and Configuration - AJF8729</title>
<meta name=description content="Install Active Directory Domain Services  https://github.com/ajf8729/Lab/blob/main/NewLabDomain.ps1    # Example syntax to install AD DS using NewLabDomain.ps1 # Run from host running Hyper-V $Parameters = @{ LabName = LAB01 VMHostname = LAB01DC01A Username = Administrator Password = 'bf1456b8-a91f-4a41-92a8-8388ff07dd6d' DomainName = lab01.domain.tld DomainNetBIOSName = LAB01 SafeModeAdministratorPassword = 'bf1456b8-a91f-4a41-92a8-8388ff07dd6d' Verbose = $true } .\NewLabDomain.ps1 @Parameters Configure Active Directory Domain Services  https://github.com/ajf8729/Lab/blob/main/ConfigureLabDomain.ps1    # Example syntax to install AD DS using ConfigureLabDomain.">
<meta name=author content>
<link rel="preload stylesheet" as=style href=https://ajf8729.com/app.min.css>
<link rel=preload as=image href=https://ajf8729.com/theme.png>
<link rel=preload as=image href=https://ajf8729.com/twitter.svg>
<link rel=preload as=image href=https://ajf8729.com/github.svg>
<link rel=icon href=https://ajf8729.com/favicon.ico>
<link rel=apple-touch-icon href=https://ajf8729.com/apple-touch-icon.png>
<meta name=generator content="Hugo 0.92.1">
<meta property="og:title" content="Part 02: Active Directory Domain Services - Installation and Configuration">
<meta property="og:description" content="Active Directory Domain Services - Installation and Configuration">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ajf8729.com/guide/02-adds-installation-configuration/"><meta property="article:section" content="guide">
<meta property="article:published_time" content="2022-02-07T17:00:00+00:00">
<meta property="article:modified_time" content="2022-02-07T17:00:00+00:00">
<meta itemprop=name content="Part 02: Active Directory Domain Services - Installation and Configuration">
<meta itemprop=description content="Active Directory Domain Services - Installation and Configuration"><meta itemprop=datePublished content="2022-02-07T17:00:00+00:00">
<meta itemprop=dateModified content="2022-02-07T17:00:00+00:00">
<meta itemprop=wordCount content="288">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Part 02: Active Directory Domain Services - Installation and Configuration">
<meta name=twitter:description content="Active Directory Domain Services - Installation and Configuration">
</head>
<body class=not-ready data-menu=true>
<header class=header>
<p class=logo>
<a class=site-name href=https://ajf8729.com/>AJF8729</a><a class=btn-dark></a>
</p>
<script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=a=>{bodyClx[a?'add':'remove']('dark'),localStorage.setItem('dark',a?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',a=>setDark(a.matches))</script>
<nav class=menu>
<a href=/about/>About</a>
<a href=/resume/>Resume</a>
<a href=/post/>Posts</a>
<a href=/guide/>Guides</a>
<a href=/certs/>Certificate Authorities</a>
</nav>
<nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/ajf8729 target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/ajf8729 target=_blank></a>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>Feb 7, 2022</time>
</p>
<h1>Part 02: Active Directory Domain Services - Installation and Configuration</h1>
</header>
<section class=post-content><ol>
<li>Install Active Directory Domain Services
<ul>
<li><a href=https://github.com/ajf8729/Lab/blob/main/NewLabDomain.ps1>https://github.com/ajf8729/Lab/blob/main/NewLabDomain.ps1</a></li>
</ul>
</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Example</span> <span style=color:#a6e22e>syntax</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>AD</span> <span style=color:#a6e22e>DS</span> <span style=color:#a6e22e>using</span> <span style=color:#a6e22e>NewLabDomain.ps1</span>
<span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Run</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>host</span> <span style=color:#a6e22e>running</span> <span style=color:#a6e22e>Hyper-V</span>

<span style=color:#a6e22e>$Parameters</span> <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>@</span>{
    <span style=color:#a6e22e>LabName</span>                       <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>LAB01</span>
    <span style=color:#a6e22e>VMHostname</span>                    <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>LAB01DC01A</span>
    <span style=color:#a6e22e>Username</span>                      <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>Administrator</span>
    <span style=color:#a6e22e>Password</span>                      <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>&#39;bf1456b8-a91f-4a41-92a8-8388ff07dd6d&#39;</span>
    <span style=color:#a6e22e>DomainName</span>                    <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>lab01.domain.tld</span>
    <span style=color:#a6e22e>DomainNetBIOSName</span>             <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>LAB01</span>
    <span style=color:#a6e22e>SafeModeAdministratorPassword</span> <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>&#39;bf1456b8-a91f-4a41-92a8-8388ff07dd6d&#39;</span>
    <span style=color:#a6e22e>Verbose</span>                       <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>$true</span>
}

<span style=color:#a6e22e>.\NewLabDomain.ps1</span> <span style=color:#a6e22e>@Parameters</span>
</code></pre></div><ol start=2>
<li>Configure Active Directory Domain Services
<ul>
<li><a href=https://github.com/ajf8729/Lab/blob/main/ConfigureLabDomain.ps1>https://github.com/ajf8729/Lab/blob/main/ConfigureLabDomain.ps1</a></li>
</ul>
</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Example</span> <span style=color:#a6e22e>syntax</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>AD</span> <span style=color:#a6e22e>DS</span> <span style=color:#a6e22e>using</span> <span style=color:#a6e22e>ConfigureLabDomain.ps1</span>
<span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Run</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>within</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>domain</span> <span style=color:#a6e22e>controller</span> <span style=color:#a6e22e>VM</span>
<span style=color:#a6e22e>#</span> <span style=color:#a6e22e>This</span> <span style=color:#a6e22e>script</span> <span style=color:#a6e22e>will</span> <span style=color:#a6e22e>prompt</span> <span style=color:#a6e22e>for</span> <span style=color:#ae81ff>4</span> <span style=color:#a6e22e>account</span> <span style=color:#a6e22e>passwords;</span> <span style=color:#a6e22e>domain</span> <span style=color:#a6e22e>admin,</span> <span style=color:#a6e22e>server</span> <span style=color:#a6e22e>admin,</span> <span style=color:#a6e22e>workstation</span> <span style=color:#a6e22e>admin,</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>normal</span> <span style=color:#a6e22e>account</span>

<span style=color:#a6e22e>$Parameters</span> <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>@</span>{
    <span style=color:#a6e22e>ReverseZoneNetworkId</span> <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>192.168.1.0</span>/24
    <span style=color:#a6e22e>BaseUsername</span>         <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>jxs</span>
    <span style=color:#a6e22e>GivenName</span>            <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>John</span>
    <span style=color:#a6e22e>Initial</span>              <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>X</span>
    <span style=color:#a6e22e>Surname</span>              <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>Smith</span>
    <span style=color:#a6e22e>Verbose</span>              <span style=color:#a6e22e>=</span> <span style=color:#a6e22e>$true</span>
}

<span style=color:#a6e22e>.\ConfigureLabDomain.ps1</span> <span style=color:#a6e22e>@Parameters</span>
</code></pre></div><ol start=3>
<li>Configure security baselines
<ul>
<li><a href=https://github.com/ajf8729/Lab/blob/main/ConfigureSecurityBaselines.ps1>https://github.com/ajf8729/Lab/blob/main/ConfigureSecurityBaselines.ps1</a></li>
</ul>
</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Example</span> <span style=color:#a6e22e>syntax</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>configure</span> <span style=color:#a6e22e>security</span> <span style=color:#a6e22e>baselines</span> <span style=color:#a6e22e>using</span> <span style=color:#a6e22e>ConfigureSecurityBaselines.ps1</span>
<span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Run</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>within</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>domain</span> <span style=color:#a6e22e>controller</span> <span style=color:#a6e22e>VM</span>
<span style=color:#a6e22e>#</span> <span style=color:#a6e22e>This</span> <span style=color:#a6e22e>script</span> <span style=color:#a6e22e>requires</span> <span style=color:#a6e22e>no</span> <span style=color:#a6e22e>input;</span> <span style=color:#a6e22e>it</span> <span style=color:#a6e22e>will</span> <span style=color:#a6e22e>automatically</span> <span style=color:#a6e22e>download,</span> <span style=color:#a6e22e>extract,</span> <span style=color:#a6e22e>import,</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>link</span> <span style=color:#a6e22e>various</span> <span style=color:#a6e22e>security</span> <span style=color:#a6e22e>baseline</span> <span style=color:#a6e22e>GPOs</span>

<span style=color:#a6e22e>.\ConfigureSecurityBaselines.ps1</span>
</code></pre></div><ol start=4>
<li>Manually Configure GPOs:</li>
</ol>
<ul>
<li>GPO: <code>Server - ConfigMgr</code>
<ul>
<li>User Rights Assignments
<ul>
<li>&ldquo;Lock pages in memory&rdquo;: <code>DOMAIN\svc_CM_SQL$</code></li>
<li>&ldquo;Log on as a service&rdquo;: <code>DOMAIN\svc_CM_SQL$</code></li>
</ul>
</li>
<li>Windows Firewall
<ul>
<li>New Custom Inbound Rule
<ul>
<li>All Programs</li>
<li>Local TCP ports: 1433, 4022</li>
<li>Source: ConfigMgr Server IP Address</li>
<li>Destination: ConfigMgr Server IP Address</li>
<li>Allow</li>
<li>All profiles</li>
<li>Name: <code>ConfigMgr - SQL Traffic</code></li>
</ul>
</li>
</ul>
</li>
<li>New Local Group Preference
<ul>
<li>Add AD group <code>CM_Admins</code> to <code>Administrators</code></li>
<li>Set group description to <code>GPO-Enforced Group</code></li>
</ul>
</li>
</ul>
</li>
<li>GPO: <code>Server - Default Security Policy</code>
<ul>
<li>New Local Group Preference
<ul>
<li>Add AD group <code>LocalAdmin_Servers</code> to <code>Administrators</code></li>
<li>Set group description to <code>GPO-Enforced Group</code></li>
<li>Enable <code>Delete all member users</code> and <code>Delete all member groups</code></li>
</ul>
</li>
</ul>
</li>
<li>GPO: <code>Workstation - Default Security Policy</code>
<ul>
<li>New Local Group Preference
<ul>
<li>Add AD group <code>LocalAdmin_Workstations</code> to <code>Administrators</code></li>
<li>Set group description to <code>GPO-Enforced Group</code></li>
<li>Enable <code>Delete all member users</code> and <code>Delete all member groups</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<nav class=post-nav>
<a class=prev href=https://ajf8729.com/guide/01-vm-creation/><span>←</span><span>Part 01: VM Creation & Initial Configuration</span></a>
<a class=next href=https://ajf8729.com/guide/03-configmgr-sql-installation-configuration/><span>Part 03: ConfigMgr - SQL Installation and Configuration</span><span>→</span></a>
</nav>
</article>
</main>
<footer class=footer>
<p>&copy; 2022 <a href=https://ajf8729.com/>AJF8729</a></p>
<p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p>
<p>
<a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a>
</p>
</footer>
</body>
</html>